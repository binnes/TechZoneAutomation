<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Exploration of TechZone Accelerator Toolkit"><meta name=author content="Brian Innes"><link href=https://binnes.github.io/TechZoneAutomation/deploy/ rel=canonical><link rel=icon href=../assets/images/favicon.png><meta name=generator content="mkdocs-1.2.3, mkdocs-material-7.2.6"><title>Deploy - TechZone Accelerator Toolkit</title><link rel=stylesheet href=../assets/stylesheets/main.802231af.min.css><link rel=stylesheet href=../assets/stylesheets/palette.3f5d1f46.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style></head> <body dir=ltr data-md-color-scheme data-md-color-primary=none data-md-color-accent=none> <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#deploy-bill-of-materials class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title="TechZone Accelerator Toolkit" class="md-header__button md-logo" aria-label="TechZone Accelerator Toolkit" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> TechZone Accelerator Toolkit </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Deploy </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/binnes/TechZoneAutomation/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> TechZoneAutomation </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="TechZone Accelerator Toolkit" class="md-nav__button md-logo" aria-label="TechZone Accelerator Toolkit" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg> </a> TechZone Accelerator Toolkit </label> <div class=md-nav__source> <a href=https://github.com/binnes/TechZoneAutomation/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> TechZoneAutomation </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> Home </a> </li> <li class=md-nav__item> <a href=../plan/ class=md-nav__link> Plan </a> </li> <li class=md-nav__item> <a href=../setup/ class=md-nav__link> Setup </a> </li> <li class=md-nav__item> <a href=../bom/ class=md-nav__link> Bill of Materials </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Deploy <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Deploy </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#variables class=md-nav__link> Variables </a> </li> <li class=md-nav__item> <a href=#deploying-the-bill-of-materials class=md-nav__link> Deploying the Bill of Materials </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../helm/ class=md-nav__link> Helm </a> </li> <li class=md-nav__item> <a href=../reference/ class=md-nav__link> Reference </a> </li> <li class=md-nav__item> <a href=../learningEnvironment/ class=md-nav__link> Learning Env </a> </li> <li class=md-nav__item> <a href=../module/ class=md-nav__link> Create/Update Module </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#variables class=md-nav__link> Variables </a> </li> <li class=md-nav__item> <a href=#deploying-the-bill-of-materials class=md-nav__link> Deploying the Bill of Materials </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/binnes/TechZoneAutomation/edit/main/docs/deploy.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1 id=deploy-bill-of-materials>Deploy Bill of Materials<a class=headerlink href=#deploy-bill-of-materials title="Permanent link">&para;</a></h1> <p>When you have your <a href=../bom/ target=:blank>Bill of Materials (BOM)</a> you can deploy it to create the desired environment.</p> <div class="admonition todo"> <p class=admonition-title>Todo</p> <p>what is the preferred/opinionated way to pass variables into the deploy process?</p> <ul> <li>in the BOM (is a BOM a template to apply to multiple environments, or an environment specific configuration?)</li> <li>a variables file - variables.yaml or directly modify terraform variable files</li> <li>environment variables</li> <li>how are sensitive credentials supposed to be managed?</li> </ul> </div> <h2 id=variables>Variables<a class=headerlink href=#variables title="Permanent link">&para;</a></h2> <p>When a BOM is deployed there are some variables (values) that need to be provided to configure each module so the desired state can be achieved.</p> <p>When a module is created, a set of input variables are defined with the option of providing a default value for an input variable.</p> <p>Some of the input variables may be generated by a dependent module.</p> <p>The module.yaml file for a module defines the required input variables and if the variable comes from a dependent module. It is also possible for a module to define optional input variables.</p> <p>As the modules are Terraform modules, there are also the Terraform variable definitions (usually in variables.tf and output.tf). The Terraform files have the variable definitions along with any default values.</p> <div class="admonition todo"> <p class=admonition-title>Todo</p> <p>What is the relationship between the input/output variables defined in the module.yaml file and the Terraform input/output variables defined in the Terraform (.tf) files?</p> <ul> <li>is there any validation between the .yaml BOM and .tf files?</li> <li>what is the purpose of the variable information in the modules.yaml file?<ul> <li>is it used to generate the Terraform files in the output folder?</li> </ul> </li> <li>should the Terraform files be regarded as the source of truth?</li> </ul> </div> <p>You will need to provide some input variables for most modules. These allow you to customise the deployment without needing to alter the module code. It is possible to add variable values to the BOM yaml file, but Terraform also provides a number of ways to provide values to input variables:</p> <ul> <li>using the <strong>-var</strong> command line argument to pass values when invoking Terraform on the command line or from a script</li> <li>from a file containing the variable values</li> <li>as environment variables. The environment variable format Terraform uses is TF_VAR_ prepended to the input variable name</li> </ul> <p>If the <strong>launch.sh</strong> script is used to launch a tools container (Docker or Podman), then there is a specific process in place to pass environment variables using a <strong>credentials.properties</strong> file, which will set the environment variables within the tools container. The credentials file is also used to set the environment variables inside the <strong>multipass</strong> virtual machine.</p> <p>The <strong>credentials.properties</strong> file contains lines of the format:</p> <div class=highlight><pre><span></span><code><span class=nb>export</span> <span class=nv>TF_VAR_variable_name</span><span class=o>=</span><span class=s2>&quot;variable_value&quot;</span>
</code></pre></div> <p>This format ensure the environment variables will be correctly set when using multipass or using containers.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>The <strong>-var</strong> command line argument to the <strong>terraform</strong> command can only be used if you are not using the <strong>apply.sh</strong> script. See the <a href=./ >deploy</a> section for details of running a deployment</p> </div> <div class="admonition todo"> <p class=admonition-title>Todo</p> <p>need a new version of iascable to be released to incorporate this <a href=https://github.com/cloud-native-toolkit/iascable/pull/190>pull request</a>. Until then the apply.sh script will need to be manually modified after <strong>iascable build</strong> is run</p> <p>line 37 of apply.sh script should be <code>environment_variable=$(env | grep "${variable_name}" | sed -E 's/.*=(.*).*/\1/g')</code></p> </div> <p>If variables are not passed into the deploy and no default value has been defined, then you will be prompted to provide the values at deploy time</p> <h2 id=deploying-the-bill-of-materials>Deploying the Bill of Materials<a class=headerlink href=#deploying-the-bill-of-materials title="Permanent link">&para;</a></h2> <div class="admonition todo"> <p class=admonition-title>Todo</p> <p>How to manage Terraform state in a shared, team environment?</p> </div> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../bom/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Bill of Materials" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Bill of Materials </div> </div> </a> <a href=../helm/ class="md-footer__link md-footer__link--next" aria-label="Next: Helm" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Helm </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": ["content.code.annotate", "navigation.instant", "naviagation.sections", "navigation.tracking", "search.suggest", "search.highlight"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.409db549.min.js", "version": null}</script> <script src=../assets/javascripts/bundle.756773cc.min.js></script> </body> </html>